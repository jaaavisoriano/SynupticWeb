---
const legalLinks = [
  { href: '/aviso-legal/', label: 'Aviso legal' },
  { href: '/politica-privacidad/', label: 'Política de privacidad' },
  { href: '/politica-de-cookies-ue/', label: 'Política de cookies (UE)' },
];

const currentYear = new Date().getFullYear();
---

<footer id="cesis_colophon" class="site-footer">
  <div class="footer_main">
    <div class="cesis_container">
      <div class="row align-items-center">
        <!-- Contact Info -->
        <div class="col-sm-6 footer-col footer-contact">
          <h3 class="text-center">¿Quieres conocernos?</h3>
          <div class="contact-list">
            <div class="contact-item">
              <span class="contact-item__icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
              </span>
              <a href="tel:+34690009731" class="contact-item__text">+34 690009731</a>
            </div>
            <div class="contact-item email-container">
              <span class="contact-item__icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
              </span>
              <a href="mailto:hola@synuptic.es" id="email-copy" class="contact-item__text" title="Clic para copiar email">hola@synuptic.es</a>
              <span id="email-tooltip" class="copy-tooltip">¡Copiado!</span>
            </div>
            <div class="contact-item location-trigger" id="location-trigger" role="button" tabindex="0" title="Ver en mapa">
              <span class="contact-item__icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
              </span>
              <span class="contact-item__text">c/ Zurbano, 48 <span>- 28010 Madrid</span></span>
            </div>
            <div class="contact-item">
              <span class="contact-item__icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2c-4.42 0-8 3.58-8 8v7c0 1.1.9 2 2 2h2v3h2v-3h8v3h2v-3h2c1.1 0 2-.9 2-2v-7c0-4.42-3.58-8-8-8zM6 10c0-3.31 2.69-6 6-6s6 2.69 6 6v3H6v-3zm12 5H6v-2h12v2zm-4.5 1.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm-7 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>
              </span>
              <span class="contact-item__text">Metro Rubén Darío // Gregorio Marañón // Iglesia</span>
            </div>
          </div>
        </div>
        
        <!-- Map -->
        <div class="col-sm-6 footer-col">
          <div class="footer-map">
            <iframe 
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3036.879143113521!2d-3.6956054240158758!3d40.43367497143694!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xd4228f2ab0b0a11%3A0xae9ed7f61e1b69ae!2sCalle%20de%20Zurbano%2C%2048%2C%20Chamber%C3%AD%2C%2028010%20Madrid!5e0!3m2!1ses!2ses!4v1707399433337!5m2!1ses!2ses" 
              width="100%" 
              height="250" 
              style="border:0;" 
              allowfullscreen="" 
              loading="lazy" 
              referrerpolicy="no-referrer-when-downgrade"
              title="Ubicación de Synuptic en Madrid"
            ></iframe>
          </div>
        </div>
      </div>

      <!-- New Bottom Section: Logo & Legal Links -->
      <div class="footer-bottom-section">
        <div class="footer-logo-container">
          <img 
            src="/images/logo.svg" 
            alt="Synuptic" 
            class="footer-logo-bottom"
            width="150"
            height="54"
          >
        </div>
        <ul class="footer-legal-links">
          {legalLinks.map((link) => (
            <li><a href={link.href}>{link.label}</a></li>
          ))}
        </ul>
      </div>
    </div>
  </div>
  
  <div class="footer_sub">
    <div class="cesis_container">
      <div class="footer_sub__text">
        <span>©{currentYear} - Sinergias en Salud</span>
      </div>
      <div class="f_si">
        <span class="cesis_social_icons cesis_simple">
          <a 
            href="https://www.linkedin.com/company/synuptic/" 
            target="_blank" 
            rel="noopener noreferrer"
            aria-label="LinkedIn"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
          </a>
        </span>
      </div>
    </div>
  </div>
  <!-- Maps Selection Modal -->
  <div id="maps-modal" class="maps-modal">
    <div class="maps-modal-overlay"></div>
    <div class="maps-modal-container">
      <button class="maps-modal-close" aria-label="Cerrar">&times;</button>
      <h3 class="maps-modal-title">Abrir ubicación en</h3>
      <div class="maps-modal-options">
        <a href="https://www.google.com/maps/search/?api=1&query=Calle+de+Zurbano+48,+28010+Madrid" target="_blank" rel="noopener noreferrer" class="map-option google">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="map-icon">
             <path d="M12 0C7.31 0 3.5 3.81 3.5 8.5c0 5.59 7.42 14.54 7.74 14.92.19.23.48.37.76.37.28 0 .57-.14.76-.37.31-.38 7.74-9.33 7.74-14.92C20.5 3.81 16.69 0 12 0zm0 12.8c-2.37 0-4.3-1.93-4.3-4.3 0-2.37 1.93-4.3 4.3-4.3 2.37 0 4.3 1.93 4.3 4.3 0 2.37-1.93 4.3-4.3 4.3z"/>
          </svg>
          Google Maps
        </a>
        <a href="https://maps.apple.com/?q=Calle+de+Zurbano+48,+28010+Madrid" target="_blank" rel="noopener noreferrer" class="map-option apple">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="map-icon">
             <path d="M16.92 12.04c.03-2.67 2.19-3.96 2.29-4.02-1.25-1.83-3.19-2.08-3.87-2.11-1.63-.17-3.18.96-4.01.96-.83 0-2.11-.94-3.48-.91-1.78.03-3.43 1.04-4.35 2.65-1.86 3.22-.48 7.97 1.33 10.58.89 1.28 1.94 2.71 3.32 2.66 1.33-.05 1.83-.86 3.44-.86 1.6 0 2.06.86 3.46.83 1.44-.03 2.35-1.3 3.23-2.58 1.01-1.48 1.43-2.91 1.45-2.99-.03-.02-2.78-1.07-2.81-4.21M12.78 4.25c.73-.88 1.22-2.1 1.08-3.32-1.05.04-2.31.7-3.06 1.58-.67.78-1.26 2.05-1.1 3.23 1.17.09 2.36-.6 3.08-1.49"/>
          </svg>
          Apple Maps
        </a>
      </div>
    </div>
  </div>
</footer>

<style>
  /* Footer Restructuring Styles */
  .footer_main {
    padding-bottom: 2rem;
  }

  .footer-col {
    margin-bottom: 30px;
  }

  .contact-list {
    display: flex;
    flex-direction: column;
    align-items: center; /* Center contact items */
    gap: 10px;
  }

  .contact-item {
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: center;
  }

  .contact-item__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-primary);
  }

  /* Expand Map to fill column */
  .footer-map iframe {
    width: 100%;
    border-radius: 8px; /* Optional: adds a nice touch */
  }

  /* Bottom Section Styles */
  .footer-bottom-section {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    margin-top: 40px;
    padding-top: 30px;
    border-top: 1px solid rgba(0, 0, 0, 0.05); /* Subtle separator */
  }

  .footer-logo-bottom {
    opacity: 0.8; /* Slightly muted for elegance */
    transition: opacity 0.3s ease;
    margin-bottom: 0;
  }

  .footer-logo-bottom:hover {
    opacity: 1;
  }

  .footer-legal-links {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 24px;
  }

  .footer-legal-links li a {
    color: #666; /* Muted text color */
    font-size: 0.85rem;
    text-decoration: none;
    text-transform: uppercase; /* Elegant touch */
    letter-spacing: 0.05em;
    font-weight: 500;
    transition: color 0.3s ease;
  }

  .footer-legal-links li a:hover {
    color: var(--primary-color, #000); /* Use primary color on hover if available, else black */
  }

  @media (max-width: 767px) {
    .footer-legal-links {
      flex-direction: column;
      gap: 12px;
      text-align: center;
    }
    
    .footer-bottom-section {
        flex-direction: column;
        gap: 20px;
        margin-top: 20px;
        padding-top: 20px;
    }
  }

  /* Dark Mode Styles */
  :global([data-theme="dark"]) .site-footer {
    background-color: var(--color-bg-subtle);
    color: var(--color-text-body);
  }

  :global([data-theme="dark"]) .contact-item__text {
    color: rgba(255, 255, 255, 0.9);
  }

  :global([data-theme="dark"]) .contact-item__icon {
    color: rgba(255, 255, 255, 0.9);
  }

  :global([data-theme="dark"]) .contact-item__text a:hover {
    color: var(--color-accent);
  }

  :global([data-theme="dark"]) .footer-legal-links li a {
    color: rgba(255, 255, 255, 0.7);
  }

  :global([data-theme="dark"]) .footer-legal-links li a:hover {
    color: var(--color-accent);
  }

  :global([data-theme="dark"]) .footer-logo-bottom {
    filter: brightness(0) invert(1);
    opacity: 0.8;
  }

  :global([data-theme="dark"]) .footer-bottom-section {
    border-top-color: rgba(255, 255, 255, 0.1);
  }

  :global([data-theme="dark"]) .footer_sub__text span {
    color: rgba(255, 255, 255, 0.6);
  }

  /* Email Copy Tooltip */
  .email-container {
    position: relative;
    display: inline-flex; /* Maintain alignment in flex container */
    align-items: center;
  }
  
  #email-copy {
    cursor: pointer;
  }

  .copy-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background-color: #333;
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 0.8rem;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.3s ease;
    white-space: nowrap;
    margin-bottom: 8px; /* Space above the text */
    z-index: 10;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }

  .copy-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #333 transparent transparent transparent;
  }

  .copy-tooltip.visible {
    opacity: 1;
    transform: translateX(-50%) translateY(-5px);
  }

  /* Tooltip Dark Mode Support */
  :global([data-theme="dark"]) .copy-tooltip {
    background-color: #f0f0f0;
    color: #333;
  }
  :global([data-theme="dark"]) .copy-tooltip::after {
    border-top-color: #f0f0f0;
  }

  /* Location Contact Item Interactive */
  .location-trigger {
    cursor: pointer;
    transition: transform 0.2s ease, opacity 0.2s ease;
  }
  
  .location-trigger:hover {
    transform: translateY(-2px);
    opacity: 0.8;
  }

  /* Maps Modal Styles */
  .maps-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10000;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .maps-modal.active {
    opacity: 1;
    pointer-events: auto;
  }

  .maps-modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
  }

  .maps-modal-container {
    position: relative;
    background: #fff;
    padding: 30px;
    border-radius: 16px;
    width: 90%;
    max-width: 350px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    transform: translateY(20px);
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    z-index: 2;
    text-align: center;
  }

  .maps-modal.active .maps-modal-container {
    transform: translateY(0);
  }

  .maps-modal-close {
    position: absolute;
    top: 10px;
    right: 15px;
    background: none;
    border: none;
    font-size: 24px;
    color: #999;
    cursor: pointer;
    line-height: 1;
    padding: 0;
    transition: color 0.2s;
  }

  .maps-modal-close:hover {
    color: #333;
  }

  .maps-modal-title {
    margin-top: 0;
    margin-bottom: 25px;
    font-size: 1.2rem;
    font-weight: 600;
    color: #333;
  }

  .maps-modal-options {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .map-option {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 12px 20px;
    border-radius: 4px; /* Matching .btn border-radius */
    text-decoration: none;
    font-weight: 700; /* Matching .btn font-weight */
    transition: all 0.3s ease;
    border: 1px solid var(--color-primary);
    background-color: var(--color-primary);
    color: var(--color-white);
    text-transform: uppercase;
    font-size: 0.9rem;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  .map-option svg {
    width: 20px;
    height: 20px;
    fill: currentColor;
  }

  .map-option:hover {
    background-color: var(--color-accent);
    border-color: var(--color-accent);
    color: var(--color-white);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
  }

  /* Specific tweaks if needed, but keeping them uniform as per request */
  .map-option.google, .map-option.apple {
    /* Ensuring overrides if any previous specific classes remain */
    background-color: var(--color-primary);
    color: var(--color-white);
    border-color: var(--color-primary);
  }

  .map-option.google:hover, .map-option.apple:hover {
    background-color: var(--color-accent);
    border-color: var(--color-accent);
    color: var(--color-white);
  }

  /* Dark Mode for Modal - Buttons stay consistent as they are corporate colors */
  :global([data-theme="dark"]) .maps-modal-container {
    background: var(--color-bg-card, #1a1a1a);
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  :global([data-theme="dark"]) .maps-modal-title {
    color: #fff;
  }

</style>

<!-- Scroll to Top Button -->
<a id="cesis_to_top" aria-label="Volver arriba">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
    <path d="M12 4l-8 8h5v8h6v-8h5z"/>
  </svg>
</a>

<script>
  // Variables to hold cleanup functions for global listeners
  let cleanupScroll;
  let cleanupEsc;

  const initFooter = () => {
    // --- 1. Scroll to top functionality ---
    const scrollTopBtn = document.getElementById('cesis_to_top');
    
    if (scrollTopBtn) {
      // Click listener (element-bound, safe to re-add on new elements)
      scrollTopBtn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });

      // Cleanup previous scroll listener if it exists
      if (cleanupScroll) cleanupScroll();

      // Window Scroll listener (Global)
      const handleScroll = () => {
        if (window.scrollY > 300) {
          scrollTopBtn.classList.add('visible');
        } else {
          scrollTopBtn.classList.remove('visible');
        }
      };
      
      window.addEventListener('scroll', handleScroll, { passive: true });
      cleanupScroll = () => window.removeEventListener('scroll', handleScroll);
      
      // Initial check
      handleScroll();
    }

    // --- 2. Email click to copy functionality ---
    const emailLink = document.getElementById('email-copy');
    const tooltip = document.getElementById('email-tooltip');

    if (emailLink && tooltip) {
      emailLink.addEventListener('click', async (e) => {
        e.preventDefault();
        
        try {
          await navigator.clipboard.writeText('hola@synuptic.es');
          
          // Show tooltip
          tooltip.classList.add('visible');
          
          // Hide after 2 seconds
          setTimeout(() => {
            tooltip.classList.remove('visible');
          }, 2000);
        } catch (err) {
          console.error('Failed to copy text: ', err);
        }
      });
    }

    // --- 3. Maps Modal Logic ---
    const locationTrigger = document.getElementById('location-trigger');
    const mapsModal = document.getElementById('maps-modal');
    const mapsModalClose = document.querySelector('.maps-modal-close');
    const mapsModalOverlay = document.querySelector('.maps-modal-overlay');

    if (locationTrigger && mapsModal) {
      const openModal = () => mapsModal.classList.add('active');
      const closeModal = () => mapsModal.classList.remove('active');

      locationTrigger.addEventListener('click', openModal);
      locationTrigger.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openModal();
        }
      });

      if (mapsModalClose) mapsModalClose.addEventListener('click', closeModal);
      if (mapsModalOverlay) mapsModalOverlay.addEventListener('click', closeModal);

      // Cleanup previous Esc listener
      if (cleanupEsc) cleanupEsc();

      // Document Keydown listener (Global)
      const handleEsc = (e) => {
        if (e.key === 'Escape' && mapsModal.classList.contains('active')) {
          closeModal();
        }
      };

      document.addEventListener('keydown', handleEsc);
      cleanupEsc = () => document.removeEventListener('keydown', handleEsc);
    }
  };

  // Run on initial load and every subsequent navigation
  document.addEventListener('astro:page-load', initFooter);
</script>
